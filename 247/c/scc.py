from Crypto.Util.number import getStrongPrime
from fractions import gcd
from secret import flag

def get_key(e=65537, bit_length=2048):
    while True:
        p = getStrongPrime(bit_length, e=e)
        q = getStrongPrime(bit_length, e=e)
        if gcd(e, (p - 1) * (q - 1)) == 1:
            return e, p * q

def encrypt(e, n, m):
    return [((ord(c) ** e) % n) for c in m]

e, n = get_key()

print("Generated key:")
print(e)
print(n)
#909193180607169730928877645070327819694835874221183905239040600481564219496549170740715570321436648643296246577952530286445740811442175031150028203416010713127103183498015199963759060238668656562720245807131329434079860576914658919174542075897267434002194063938817495166690183839716179931129989707243225404059652125828619458523804338365481266829617406113698464217454261869972176582579989894506031054440321852753937600016678878596616927187914667226552238638031488411721806248408207245248542695890589529869734309934242896420270694938788477235151932477889703431606380573812928152596950891842981642861107885015968996631347538231200342275616015690462707386275456287049772277637379506267328445476462602084580773678764228642899139375838305130296491033084515157991707314550889377168974635766650154742311745382594642876222152370428317408079084865464529882165022460841825970826389862781916931282916191168479883017819972965377708926502480683223905790013483385403867582120263945023227849829704497515605576966672801162159615614637324218488210304744171838935349623532180093004354230433944121745381226806673877370240135191388197823001332319702414887208929984475410680666613500085415193385214447737400673402522441649057510877207502203912638566995909
# 두 소수 p, q를 곱한 n을 구하는 과정에서 e와 (p-1)(q-1)의 최대공약수가 1이 되도록 하는 것이 중요하다.

print("Encrypted flag:")
print(encrypt(e, n, flag))
#이하의 배열은 flag그를 ord()한 후 65537로 거듭제고한 후 저 긴 수로 나눈 나머지이다.;
#ord()는 유니코드 정수를 리턴하니 그냥 정수라고 생각하면 된다. 
#어떤 정수를 65537로 거듭제곱하고 x로 나눈 나머지가 y이다. 이 때 어떤 정수를 알아야 한다.
#어떤 정수를 f라고 하면 f^65537 % x = y이다.

#이 때 f를 구하는 방법은 다음과 같다.
#1. y에 x의 역원을 곱한다.
#2. 그 결과를 65537의 역원으로 나눈다.
#3. 그 결과를 x로 나눈 나머지를 구한다.
#4. 그 결과가 f이다.ß
